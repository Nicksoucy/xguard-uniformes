<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="XGuard - Système de Gestion des Uniformes">
    <meta name="author" content="XGuard Security">
    <meta name="theme-color" content="#7c3aed">
    
    <title>XGuard - Système de Gestion des Uniformes</title>
    
    <!-- Favicon (optionnel - à ajouter si vous avez un logo) -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuration TailwindCSS personnalisée -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-in': 'slideIn 0.4s ease-out',
                        'pulse': 'pulse 2s infinite',
                        'spin': 'spin 1s linear infinite'
                    }
                }
            }
        }
    </script>
    
    <!-- SignaturePad pour les signatures électroniques -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    
    <!-- jsPDF pour la génération de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Chart.js pour les graphiques (optionnel) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Styles personnalisés -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Styles inline critiques pour le chargement initial -->
    <style>
        /* Styles critiques pour éviter le FOUC (Flash of Unstyled Content) */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Loader initial */
        #initial-loader {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease-out;
        }
        
        #initial-loader.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader-spinner {
            width: 64px;
            height: 64px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Empêcher le scroll pendant le chargement */
        body.loading {
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 loading">
    <!-- Loader initial -->
    <div id="initial-loader">
        <div class="text-center">
            <div class="loader-spinner mx-auto mb-4"></div>
            <div class="text-white">
                <h1 class="text-2xl font-bold mb-2">XGuard</h1>
                <p class="text-sm opacity-80">Chargement du système...</p>
            </div>
        </div>
    </div>

    <!-- Conteneur principal de l'application -->
    <div id="app"></div>

    <!-- Conteneur pour les notifications toast (optionnel) -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Scripts de l'application -->
    <script type="module">
        // Import du module principal
        import { XGuardApp } from './js/app.js';
        
        // Fonction pour masquer le loader
        function hideLoader() {
            const loader = document.getElementById('initial-loader');
            if (loader) {
                loader.classList.add('fade-out');
                document.body.classList.remove('loading');
                setTimeout(() => {
                    loader.remove();
                }, 300);
            }
        }
        
        // Fonction pour afficher une erreur critique
        function showCriticalError(message) {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="min-h-screen flex items-center justify-center p-4 gradient-bg">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
                        <div class="mb-6">
                            <div class="w-24 h-24 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto">
                                <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Erreur de chargement</h2>
                        <p class="text-gray-600 mb-6">${message}</p>
                        <button onclick="location.reload()" 
                            class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-xl hover:from-purple-700 hover:to-purple-800 transition font-medium">
                            Rafraîchir la page
                        </button>
                    </div>
                </div>
            `;
            hideLoader();
        }
        
        // Initialisation de l'application
        async function initializeApp() {
            try {
                // Vérifier que tous les modules sont chargés
                if (typeof XGuardApp === 'undefined') {
                    throw new Error('Module principal non chargé');
                }
                
                // Créer l'instance de l'application
                window.app = new XGuardApp();
                
                // Masquer le loader après initialisation
                setTimeout(hideLoader, 500);
                
            } catch (error) {
                console.error('Erreur lors de l\'initialisation:', error);
                showCriticalError('Impossible de charger l\'application. Veuillez vérifier votre connexion et réessayer.');
            }
        }
        
        // Démarrer l'initialisation quand le DOM est prêt
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // Gestionnaire d'erreurs global
        window.addEventListener('error', (event) => {
            console.error('Erreur globale:', event.error);
        });
        
        // Gestionnaire pour les promesses rejetées
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Promesse rejetée:', event.reason);
        });
        
        // Service Worker pour le mode hors ligne (optionnel)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(err => {
                console.log('Service Worker non disponible:', err);
            });
        }
    </script>

    <!-- Script de fallback si les modules ES6 ne sont pas supportés -->
    <script nomodule>
        document.getElementById('app').innerHTML = `
            <div class="min-h-screen flex items-center justify-center p-4 gradient-bg">
                <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
                    <div class="mb-6">
                        <div class="w-24 h-24 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto">
                            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Navigateur non compatible</h2>
                    <p class="text-gray-600">Votre navigateur ne supporte pas les fonctionnalités modernes requises. Veuillez utiliser une version récente de Chrome, Firefox, Safari ou Edge.</p>
                </div>
            </div>
        `;
        document.getElementById('initial-loader').style.display = 'none';
    </script>

    <!-- Google Analytics ou autre tracking (optionnel) -->
    <!--
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    -->
</body>
</html>
