<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>XGuard – Gestion des uniformes</title>
  <meta name="description" content="Application XGuard pour la gestion des uniformes : employés, inventaire, attributions, retours et signatures." />
  <link rel="stylesheet" href="css/styles.css" />

  <!-- (Optionnel) Tailwind CDN si tu l'utilises encore directement -->
  <!-- <script src="https://cdn.tailwindcss.com"></script> -->

  <!-- ================= Firebase (v10) ================= -->
  <!-- Initialise Firebase + expose Firestore en global -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ⚠️ Ta config (tu peux la laisser telle quelle)
    const firebaseConfig = {
      apiKey: "AIzaSyBT8bjhN5y2uJvn2IhvH5fVUGy-GGonsl4",
      authDomain: "xguard-uniformes.firebaseapp.com",
      projectId: "xguard-uniformes",
      storageBucket: "xguard-uniformes.appspot.com",  // corrigé
      messagingSenderId: "691025581173",
      appId: "1:691025581173:web:2b352d88770693628e543c",
      measurementId: "G-01CSX8L38E"
    };

    const appFB = initializeApp(firebaseConfig);
    // On met Firestore et quelques helpers sur window pour y accéder depuis tes modules
    window.dbCloud = getFirestore(appFB);
    window.fb = { doc, setDoc, getDoc, updateDoc };
  </script>

  <!-- ================= Helpers globaux ================= -->
  <script>
    // BASE publique de l’application sur GitHub Pages (utile si tu en as besoin)
    window.XGUARD_BASE = 'https://nicksoucy.github.io/xguard-uniformes/';
  </script>
</head>

<body class="bg-gray-50">
  <!-- Conteneur principal rendu par js/app.js -->
  <div id="app"></div>

  <!-- ================= Application ================= -->
  <!-- IMPORTANT : js/app.js importe les autres modules (app-transactions.js, etc.) -->
  <script type="module">
    import { XGuardApp } from './js/app.js';

    // Boot de l'app
    window.app = new XGuardApp();

    // 1) Détection d'un lien de signature ?token=XXXX
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');

    if (token) {
      // On passe le token à l'app et on bascule sur la vue "signature"
      window.app.currentToken = token;
      window.app.currentView  = 'signature';
    }

    // 2) Premier rendu
    window.app.render();

    // 3) (Option futur) Réécrire l'URL après rendu pour enlever le ?token de la barre d'adresse
    // if (token && history.replaceState) {
    //   const cleanUrl = window.location.origin + window.location.pathname;
    //   history.replaceState({}, document.title, cleanUrl);
    // }
  </script>
</body>
</html>
